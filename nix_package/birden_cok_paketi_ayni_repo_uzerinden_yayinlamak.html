
<!doctype html>
<html lang="tr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://nixogreniyoruz.kavakci.dev/nix_package/birden_cok_paketi_ayni_repo_uzerinden_yayinlamak.html">
      
      
        <link rel="prev" href="nix_flake_nedir.html">
      
      
        <link rel="next" href="override_ve_overlay.html">
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Birden Çok Paketi Aynı Repo Üzeriden Yayınlamak - NixOS Öğreniyoruz - Murat Çabuk</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%208a4%204%200%200%200-4%204%204%204%200%200%200%204%204%204%204%200%200%200%204-4%204%204%200%200%200-4-4%22/%3E%3C/svg%3E');}</style>


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Birden Çok Paketi Aynı Repo Üzeriden Yayınlamak - NixOS Öğreniyoruz - Murat Çabuk" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://nixogreniyoruz.kavakci.dev/assets/images/social/nix_package/birden_cok_paketi_ayni_repo_uzerinden_yayinlamak.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://nixogreniyoruz.kavakci.dev/nix_package/birden_cok_paketi_ayni_repo_uzerinden_yayinlamak.html" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Birden Çok Paketi Aynı Repo Üzeriden Yayınlamak - NixOS Öğreniyoruz - Murat Çabuk" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://nixogreniyoruz.kavakci.dev/assets/images/social/nix_package/birden_cok_paketi_ayni_repo_uzerinden_yayinlamak.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="#7EBAE4" data-md-color-accent="#7EBAE4">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#birden-cok-paketi-ayn-repo-uzeriden-yaynlamak" class="md-skip">
          Ana içeriğe geç
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Başlık">
    <a href="../index.html" title="NixOS Öğreniyoruz - Murat Çabuk" class="md-header__button md-logo" aria-label="NixOS Öğreniyoruz - Murat Çabuk" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m7.352 1.592-1.364.002L5.32 2.75l1.557 2.713-3.137-.008-1.32 2.34h11.69l-1.353-2.332-3.192-.006-2.214-3.865zm6.175 0-2.687.025 5.846 10.127 1.341-2.34-1.59-2.765 2.24-3.85-.683-1.182h-1.336l-1.57 2.705-1.56-2.72zm6.887 4.195-5.846 10.125 2.696-.008 1.601-2.76 4.453.016.682-1.183-.666-1.157-3.13-.008L21.778 8.1l-1.365-2.313zM9.432 8.086l-2.696.008-1.601 2.76-4.453-.016L0 12.02l.666 1.157 3.13.008-1.575 2.71 1.365 2.315zM7.33 12.25l-.006.01-.002-.004-1.342 2.34 1.59 2.765-2.24 3.85.684 1.182H7.35l.004-.006h.001l1.567-2.698 1.558 2.72 2.688-.026-.004-.006h.01zm2.55 3.93 1.354 2.332 3.192.006 2.215 3.865 1.363-.002.668-1.156-1.557-2.713 3.137.008 1.32-2.34z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NixOS Öğreniyoruz - Murat Çabuk
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Birden Çok Paketi Aynı Repo Üzeriden Yayınlamak
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="slate" data-md-color-primary="#7EBAE4" data-md-color-accent="#7EBAE4"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="default" data-md-color-primary="#7EBAE4" data-md-color-accent="#7EBAE4"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Ara" placeholder="Ara" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Ara">
        
        <button type="reset" class="md-search__icon md-icon" title="Temizle" aria-label="Temizle" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Arama başlatılıyor
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/LinuxTurkey/nix-ogreniyoruz" title="Depoya git" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    LinuxTurkey/nix-ogreniyoruz
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigasyon" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="NixOS Öğreniyoruz - Murat Çabuk" class="md-nav__button md-logo" aria-label="NixOS Öğreniyoruz - Murat Çabuk" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m7.352 1.592-1.364.002L5.32 2.75l1.557 2.713-3.137-.008-1.32 2.34h11.69l-1.353-2.332-3.192-.006-2.214-3.865zm6.175 0-2.687.025 5.846 10.127 1.341-2.34-1.59-2.765 2.24-3.85-.683-1.182h-1.336l-1.57 2.705-1.56-2.72zm6.887 4.195-5.846 10.125 2.696-.008 1.601-2.76 4.453.016.682-1.183-.666-1.157-3.13-.008L21.778 8.1l-1.365-2.313zM9.432 8.086l-2.696.008-1.601 2.76-4.453-.016L0 12.02l.666 1.157 3.13.008-1.575 2.71 1.365 2.315zM7.33 12.25l-.006.01-.002-.004-1.342 2.34 1.59 2.765-2.24 3.85.684 1.182H7.35l.004-.006h.001l1.567-2.698 1.558 2.72 2.688-.026-.004-.006h.01zm2.55 3.93 1.354 2.332 3.192.006 2.215 3.865 1.363-.002.668-1.156-1.557-2.713 3.137.008 1.32-2.34z"/></svg>

    </a>
    NixOS Öğreniyoruz - Murat Çabuk
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/LinuxTurkey/nix-ogreniyoruz" title="Depoya git" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    LinuxTurkey/nix-ogreniyoruz
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NixOS
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Nix Dili
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Nix Dili
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nix_lang/01_nix_dili_ve_ozellikleri.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nix Dili ve Özellikleri
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nix_lang/02_nix_dili_alistirmalari.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nix Dili ile İlgili Alıştırmalar
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nix_lang/03_nix_dili_gomulu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nix Dilinde Gömülü Fonksiyonlar
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Nix Paket Yöneticisi
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Nix Paket Yöneticisi
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nix_paket_yoneticisi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nix Paket Yöneticisi
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nix_shell_ve_profile.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nix Shell ve Profile
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="nix_flake_nedir.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nix Flake Nedir?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Birden Çok Paketi Aynı Repo Üzeriden Yayınlamak
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="birden_cok_paketi_ayni_repo_uzerinden_yayinlamak.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Birden Çok Paketi Aynı Repo Üzeriden Yayınlamak
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="İçindekiler">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      İçindekiler
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#callpackages-fonksiyonunu-kullanarak-birden-fazla-paketi-sunmak" class="md-nav__link">
    <span class="md-ellipsis">
      callPackages Fonksiyonunu kullanarak Birden Fazla Paketi Sunmak
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flake-yonetimi-icin-frameworkler" class="md-nav__link">
    <span class="md-ellipsis">
      Flake Yönetimi için Framework'ler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repommuzu-callpackege-fonksiyonu-ile-yeniden-yazyoruz" class="md-nav__link">
    <span class="md-ellipsis">
      Repommuzu callPackege fonksiyonu ile Yeniden Yazıyoruz.
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="override_ve_overlay.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Override ve Overlay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="developer_ve_profile_ortamlari_olusturmak.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer ve Profile Ortamları Oluşturmak
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Sonrası
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Sonrası
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nix_ile_nix_konfigurasyonu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nix ile NixOS Konfigürasyonu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../module_ve_option_kullanimi.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Module ve Option Kullanımı
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nixos_kurulumu_ve_konfigurasyonu.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NixOS Kurulumu ve Konfigürasyonu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nixos_cloud_ve_uzak_ortam.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NixOS'u Cloud ve Uzak Ortamlara Deploy Etmek
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="İçindekiler">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      İçindekiler
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#callpackages-fonksiyonunu-kullanarak-birden-fazla-paketi-sunmak" class="md-nav__link">
    <span class="md-ellipsis">
      callPackages Fonksiyonunu kullanarak Birden Fazla Paketi Sunmak
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flake-yonetimi-icin-frameworkler" class="md-nav__link">
    <span class="md-ellipsis">
      Flake Yönetimi için Framework'ler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repommuzu-callpackege-fonksiyonu-ile-yeniden-yazyoruz" class="md-nav__link">
    <span class="md-ellipsis">
      Repommuzu callPackege fonksiyonu ile Yeniden Yazıyoruz.
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/LinuxTurkey/nix-ogreniyoruz/edit/main/src/nix_package/birden_cok_paketi_ayni_repo_uzerinden_yayinlamak.md" title="Düzenle" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/LinuxTurkey/nix-ogreniyoruz/raw/main/src/nix_package/birden_cok_paketi_ayni_repo_uzerinden_yayinlamak.md" title="Sayfanın kaynağını görüntüle" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="birden-cok-paketi-ayn-repo-uzeriden-yaynlamak">Birden Çok Paketi Aynı Repo Üzeriden Yayınlamak</h1>
<p>Bir önceki yazımızda Nix diline yeni eklenmiş olan Flake kavramı hakkında konuşmuştuk. Bu yazımızda elimizdeki paketleri bir repo üzerinden nasıl yayınlarız onu göreceğiz.</p>
<p>Bunun için isterseniz bir kaç paket daha ekleyelim. Yeni paketlerinde eklendiği bu halini <strong>multi-app</strong> branch'inde bulabilirsiniz. <a href="https://github.com/muratcabuk/nix-examples/tree/multi-app">Şu linkten</a> kodları inceleyebilirsiniz.</p>
<p>Repo aynı zamanda farklı paket türlerini de örneklemiş oluyor.</p>
<ul>
<li><strong>default-app</strong>: Inline yazılmış bir shell script'ini nasıl paket olarak yayınlayacağımız gösteriyor.</li>
<li><strong>default-alt-app</strong>: default-app'in alternatif bir versiyonu ancak önemli bir farklı var. Shell script'ini çalıştırmak için kullanılan paketleri de ayrı birer paket olarak yönetmemizi sağlıyor. Böylece daha iyi yonetilebilir paket oluşturabiliyoruz.</li>
<li><strong>default-file-app</strong>: defaul-alt-app'in alternatif gibi düşünebiliriz. Temel farklı script'i bir dosyadan okuyor olması.</li>
<li><strong>nix-app</strong>: Nixpkgs'den bir paketin flake içinden çağrılıp başka bir flake olarak sunulmasını gösteren bir örnek.</li>
<li><strong>message-app</strong>: Daha önce yazmış olduğumuz message-third paketinin aynısı sadece derivation fonksiyonu flake.nix dosyasının içine taşınıdı.</li>
<li><strong>test-app</strong>: daha önce yazdığımız message-third paketinin aynısı.</li>
</ul>
<p>Flake dosyalarını biraz açalım.</p>
<ul>
<li>
<p><strong>Default-app</strong> paketinin flake dosyasında bakacak olursanız derivation ile ilgili bir tanım yok. Doğrudan bir paket oluşturmuyoruz. Ancak sonuçta bir script'imiz var ve bunu çalıştırıyoruz. Ancak Nix'in bir kolaylığı olarak shell'i doğrudan bir uygulamaymış gibi çalıştırma şansımız oluyor.
  Uygulamadaki writeShellScriptBin fonksiyonu ile bir script file oluşturabiliyoruz. 2 parametre alıyor biri dosya adı diğeride dosyanın içeriği. Örnekle ile iligi daha detaylı bilgi için <a href="https://ertt.ca/nix/shell-scripts/">şu sayfadaki örnkelere</a> ve <a href="https://nixos.wiki/wiki/Nix_Cookbook#Wrapping_packages">Nix Cookbook</a> sayfasına göz atabilirsiniz.</p>
</li>
<li>
<p><strong>Default-alt-app</strong> ise default-app in yani bir versiyonu. Default-app'de çalıştırdığımız script'ler için gerekli olan paketleri (cowsay ve ddate) sistem kendisi yönetiyor. Yani örneğin override edemiyorum yada fakrlı özelliklerini kontrol edemiyoruz. Ayrıca bütün paketler tek bir paketmiş gibi çalışıyor. Daha iyi yönetebilmemiz için ilgili paketleri de ayrı ayrı bağımlılık olarak kurmak işimize gelecektir. Bu neden flake içinde alttaki gibi bir blok ekledik.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="ss">app-buildInputs</span> <span class="o">=</span> <span class="k">with</span> pkgs<span class="p">;</span> <span class="p">[</span> cowsay ddate <span class="p">];</span>

<span class="k">in</span> pkgs<span class="o">.</span>symlinkJoin <span class="p">{</span>
        <span class="ss">name</span> <span class="o">=</span> app-name<span class="p">;</span>
        <span class="ss">paths</span> <span class="o">=</span> <span class="p">[</span> app-script <span class="p">]</span> <span class="o">++</span> app-buildInputs<span class="p">;</span> <span class="c1"># override</span>
        <span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span> pkgs<span class="o">.</span>makeWrapper <span class="p">];</span>
        <span class="ss">postBuild</span> <span class="o">=</span> <span class="s2">&quot;wrapProgram $out/bin/</span><span class="si">${</span>app-name<span class="si">}</span><span class="s2"> --prefix PATH : $out/bin&quot;</span><span class="p">;</span>
      <span class="p">};</span>
</code></pre></div>
<p>Burada kullanılan <strong>symlinkJoin</strong> kullanılan paketler için kendi paketimiz içinde sembolik linkler oluşturarak bağımlılık paketlerini doğrudan kendi paketimizin bulunduğu dizinde çalıştırılmasını sağlar. postBuild değişkeni, derleme işleminden sonra çalıştırılması gereken bir komut veya işlevi temsil eder. Bu durumda <strong>wrapProgram</strong> komutu kullanılır ve app-name ile belirtilen uygulamanın bir kopyası oluşturulur. Bu kopya, $out/bin klasörüne yerleştirilir ve PATH ortam değişkenine eklenir. yani wrapProgram fonksiyonu ile programların yapılandırmasını veya isimlerini değiştirmek için kullanabiliriz.</p>
<p>Kodu tekil olarak test etmek için klasör içindeyken <code>nix run .#</code> komutunu kullanabilirsiniz. Ayrıca oluşan paketi ve bağımlılık dosyalarını görmek için aynı dizinde oluşan result dizinini inceleyebilirsiniz.</p>
<ul>
<li><strong>default-file-app</strong> ise default-alt-app'in bir versiyonu. Tek farkı script'in bir dosyadan okunuyor olması. Bu durumda dosya okuma işlemi için <strong>builtins.readFile</strong> fonksiyonu kullanılıyor. Lokal dosyalarla çalışma konusunda nix.dev sayfasındaki <a href="https://nix.dev/tutorials/file-sets.html#">şu linke</a> bakabilirsiniz. Burada ayrıca <strong>patchShebangs</strong> adında bir fonksiyon kullandık. Bu fonksiyon yeni oluşturulacak script dosyasının <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> satırını düzenler.</li>
</ul>
<p>writeTextFile, writeText, writeTextDir, writeScript, writeScriptBin fonksiyonların hepsi Nix Store'a text dosyası oluşturamak ve metin yazmak için kullanılır. Aynı zamanda script çalıştırabilmemizi de sağlar. <a href="https://ryantm.github.io/nixpkgs/builders/trivial-builders/">Şu sayfadan</a> detayları inceleyebilirsiniz.</p>
<p>Daha overlay ve override kavramlarını görmedik ancak burayı anlamak çok da zor değil. <code>(pkgs.writeScriptBin app-name app-src).</code> fonsksiyonun çıktısı aslında</p>
<div class="highlight"><pre><span></span><code>  <span class="ss">app-src</span> <span class="o">=</span> <span class="nb">builtins</span><span class="o">.</span>readFile <span class="l">./script.sh</span><span class="p">;</span>
  <span class="ss">app-script</span> <span class="o">=</span> <span class="p">(</span>pkgs<span class="o">.</span>writeScriptBin app-name app-src<span class="p">)</span><span class="o">.</span>overrideAttrs<span class="p">(</span>old<span class="p">:</span> <span class="p">{</span>
          <span class="ss">buildCommand</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span>old<span class="o">.</span>buildCommand<span class="si">}</span><span class="se">\n</span><span class="s2"> patchShebangs $out&quot;</span><span class="p">;</span>
        <span class="p">});</span>
</code></pre></div>
<ul>
<li><strong>nix-app</strong> ise nix paket yöneticisinden br paketi alıp tekrar bir paket olarak nasıl sunarız onu gösteriyor.</li>
</ul>
<p>Ancak son tahlilde amacımız bütün bu farklı paketleri tek bir flake altından kullandırmak. Yani farklı flake'leri tek bir flake altından nasıl sunarız onu görmek istiyoruz. Tabi bunu yapmanın daha güzel yolları da var zaten bir sonraki örneğimiz bunun üzerine olacak ancak illaki salt bir flake nasıl başka bir flake içinden çağrılır buna da ihtiyacımız olabilir diye bu örneği de eklemek istedim.</p>
<p>Bif flake'in sonucunu alıp kullanabilmek için flake'in outputs fonksiyonunu kullanmamız gerekiyor. Output fonksiyonunun çıktılarından biri de bildiğimiz üzere derivative. Onu da kendi flake'imiz içinde bir output derivative'i olarak dışarı açmış oluyoruz.</p>
<p>Tekrar hatırlatıyorum kodun tamamını <strong>multi-app</strong> branch'inde bulabilirsiniz. <a href="https://github.com/muratcabuk/nix-examples/tree/multi-app">Şu linkten</a> kodları inceleyebilirsiniz.</p>
<p>Bunun için kök dizinde yazdığımız flake şu şekilde.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;My Nix Flake&quot;</span><span class="p">;</span>
  <span class="ss">inputs</span> <span class="o">=</span> <span class="p">{</span>
      nixpkgs<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="ss">outputs</span> <span class="o">=</span> <span class="p">{</span> self<span class="p">,</span> nixpkgs <span class="p">}:</span>

  <span class="k">let</span>

      <span class="ss">default-app-flake</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">./default-app/flake.nix</span><span class="p">;</span>
      <span class="ss">default-app-output</span> <span class="o">=</span> default-app-flake<span class="o">.</span>outputs <span class="p">{</span><span class="k">inherit</span> self<span class="p">;</span> <span class="k">inherit</span> nixpkgs<span class="p">;};</span>

      <span class="ss">default-alt-app-flake</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">./default-alt-app/flake.nix</span><span class="p">;</span>
      <span class="ss">default-alt-app-output</span> <span class="o">=</span> default-alt-app-flake<span class="o">.</span>outputs <span class="p">{</span><span class="k">inherit</span> self<span class="p">;</span> <span class="k">inherit</span> nixpkgs<span class="p">;};</span>

      <span class="ss">default-file-app-flake</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">./default-file-app/flake.nix</span><span class="p">;</span>
      <span class="ss">default-file-app-output</span> <span class="o">=</span> default-file-app-flake<span class="o">.</span>outputs <span class="p">{</span><span class="k">inherit</span> self<span class="p">;</span> <span class="k">inherit</span> nixpkgs<span class="p">;};</span>

      <span class="ss">message-app-flake</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">./message-app/flake.nix</span><span class="p">;</span>
      <span class="ss">message-app-output</span> <span class="o">=</span> message-app-flake<span class="o">.</span>outputs <span class="p">{</span><span class="k">inherit</span> self<span class="p">;</span> <span class="k">inherit</span> nixpkgs<span class="p">;};</span>

      <span class="ss">test-app-flake</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">./test-app/flake.nix</span><span class="p">;</span>
      <span class="ss">test-app-output</span> <span class="o">=</span> test-app-flake<span class="o">.</span>outputs <span class="p">{</span><span class="k">inherit</span> self<span class="p">;</span> <span class="k">inherit</span> nixpkgs<span class="p">;};</span>

      <span class="ss">nix-app-flake</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">./nix-app/flake.nix</span><span class="p">;</span>
      <span class="ss">nix-app-output</span> <span class="o">=</span> nix-app-flake<span class="o">.</span>outputs <span class="p">{</span><span class="k">inherit</span> self<span class="p">;</span> <span class="k">inherit</span> nixpkgs<span class="p">;};</span>

  <span class="k">in</span>
    <span class="p">{</span>
      packages<span class="o">.</span>x86_64-linux<span class="o">.</span><span class="ss">default</span> <span class="o">=</span> default-app-output<span class="o">.</span>packages<span class="o">.</span>x86_64-linux<span class="o">.</span>default<span class="p">;</span>

      packages<span class="o">.</span>x86_64-linux<span class="o">.</span><span class="ss">default-alt-app</span> <span class="o">=</span> default-alt-app-output<span class="o">.</span>packages<span class="o">.</span>x86_64-linux<span class="o">.</span>default<span class="p">;</span>

      packages<span class="o">.</span>x86_64-linux<span class="o">.</span><span class="ss">default-file-app</span> <span class="o">=</span> default-file-app-output<span class="o">.</span>packages<span class="o">.</span>x86_64-linux<span class="o">.</span>default<span class="p">;</span>

      packages<span class="o">.</span>x86_64-linux<span class="o">.</span><span class="ss">test-app</span> <span class="o">=</span> test-app-output<span class="o">.</span>packages<span class="o">.</span>x86_64-linux<span class="o">.</span>default<span class="p">;</span>

      packages<span class="o">.</span>x86_64-linux<span class="o">.</span><span class="ss">message-app</span> <span class="o">=</span> message-app-output<span class="o">.</span>packages<span class="o">.</span>x86_64-linux<span class="o">.</span>default<span class="p">;</span>

      packages<span class="o">.</span>x86_64-linux<span class="o">.</span><span class="ss">nix-app</span> <span class="o">=</span> nix-app-output<span class="o">.</span>packages<span class="o">.</span>x86_64-linux<span class="o">.</span>default<span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>İsteseniz öncelikle <code>nix flake show</code> komutu ile flake'in çıktılarını görelim.</p>
<div class="highlight"><pre><span></span><code>nix<span class="w"> </span>flake<span class="w"> </span>show

git+file:///home/.........../nix-examples?ref<span class="o">=</span>refs/heads/main<span class="p">&amp;</span><span class="nv">rev</span><span class="o">=</span>6837ce8a8da4c1e542d5b503f79e1a9733f7ff56
└───packages
<span class="w">    </span>└───x86_64-linux
<span class="w">        </span>├───default:<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;default-script&#39;</span>
<span class="w">        </span>├───default-alt-app:<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;default-alt-app&#39;</span>
<span class="w">        </span>├───default-file-app:<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;default-file-app&#39;</span>
<span class="w">        </span>├───message-app:<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;message-app&#39;</span>
<span class="w">        </span>├───nix-app:<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;hello-2.12.1&#39;</span>
<span class="w">        </span>└───test-app:<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;test-app&#39;</span>
</code></pre></div>
<p>Bütün paketlerimizi görebiliyoruz. Şimdi bir paketi çağırıp çalıştıralım.</p>
<div class="highlight"><pre><span></span><code>nix<span class="w"> </span>run<span class="w"> </span>.#message-app
<span class="c1"># sırasıyla sorular sorup ekrana yazdıracak</span>
</code></pre></div>
<p>Bir shell script ile paket oluşturmanın başka yolları da var. Örnekler için <a href="https://ryantm.github.io/nixpkgs/builders/trivial-builders/">şu sayfayı</a> inceleyebilirsiniz. Bir kaçını buraya da taşıdım.</p>
<p>Bu fonksiyonlar mkDerivation fonksiyonunu sarmayalayarak bize kolaylık sağlar.</p>
<p><strong><code>runCommand</code></strong></p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{})</span><span class="o">.</span>runCommand <span class="s2">&quot;my-example&quot;</span> <span class="p">{}</span> <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">  echo My example command is running</span>

<span class="s s-Multiline">  mkdir $out</span>

<span class="s s-Multiline">  echo I can write data to the Nix store &gt; $out/message</span>

<span class="s s-Multiline">  echo ls</span>
<span class="s s-Multiline">  ls</span>

<span class="s s-Multiline">  echo whoami</span>
<span class="s s-Multiline">  whoami</span>

<span class="s s-Multiline">  echo date</span>
<span class="s s-Multiline">  date</span>
<span class="s s-Multiline">&#39;&#39;</span>
</code></pre></div>
<p><strong><code>writeTextFile</code>, <code>writeText</code>, <code>writeTextDir</code>, <code>writeScript</code>, <code>writeScriptBin</code></strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Writes my-file to /nix/store/&lt;store path&gt;</span>
writeTextFile <span class="p">{</span>
  <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;my-file&quot;</span><span class="p">;</span>
  <span class="ss">text</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">    Contents of File</span>
<span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1"># See also the `writeText` helper function below.</span>

<span class="c1"># Writes executable my-file to /nix/store/&lt;store path&gt;/bin/my-file</span>
writeTextFile <span class="p">{</span>
  <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;my-file&quot;</span><span class="p">;</span>
  <span class="ss">text</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">    Contents of File</span>
<span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
  <span class="ss">executable</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
  <span class="ss">destination</span> <span class="o">=</span> <span class="s2">&quot;/bin/my-file&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1"># Writes contents of file to /nix/store/&lt;store path&gt;</span>
writeText <span class="s2">&quot;my-file&quot;</span>
  <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">  Contents of File</span>
<span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
<span class="c1"># Writes contents of file to /nix/store/&lt;store path&gt;/share/my-file</span>
writeTextDir <span class="s2">&quot;share/my-file&quot;</span>
  <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">  Contents of File</span>
<span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
<span class="c1"># Writes my-file to /nix/store/&lt;store path&gt; and makes executable</span>
writeScript <span class="s2">&quot;my-file&quot;</span>
  <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">  Contents of File</span>
<span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
<span class="c1"># Writes my-file to /nix/store/&lt;store path&gt;/bin/my-file and makes executable.</span>
writeScriptBin <span class="s2">&quot;my-file&quot;</span>
  <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">  Contents of File</span>
<span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
<span class="c1"># Writes my-file to /nix/store/&lt;store path&gt; and makes executable.</span>
writeShellScript <span class="s2">&quot;my-file&quot;</span>
  <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">  Contents of File</span>
<span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
<span class="c1"># Writes my-file to /nix/store/&lt;store path&gt;/bin/my-file and makes executable.</span>
writeShellScriptBin <span class="s2">&quot;my-file&quot;</span>
  <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">  Contents of File</span>
<span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
</code></pre></div>
<p><strong><code>writeShellApplication</code></strong></p>
<div class="highlight"><pre><span></span><code>writeShellApplication <span class="p">{</span>
  <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;show-nixos-org&quot;</span><span class="p">;</span>

  <span class="ss">runtimeInputs</span> <span class="o">=</span> <span class="p">[</span> curl w3m <span class="p">];</span>

  <span class="ss">text</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">    curl -s &#39;https://nixos.org&#39; | w3m -dump -T text/html</span>
<span class="s s-Multiline">  &#39;&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="callpackages-fonksiyonunu-kullanarak-birden-fazla-paketi-sunmak">callPackages Fonksiyonunu kullanarak Birden Fazla Paketi Sunmak</h2>
<p>Eğer amacımız tamamen kendi yazdığımız paketleri tek bir yerden yayınlamaksa bunu daha uygun bir yolla yapmalıyız. En çok kullanılan tekniklerden biri callPackages. Nixpkgs'i de inceleyecek olursanız bu fonksiyonunu çok sık görebilirsiniz. Hatta en iyi örneğini bütün paketlerin tek bir yerden yüklenmesini sağlayan <a href="https://github.com/NixOS/nixpkgs/blob/master/pkgs/top-level/all-packages.nix">Nixpkgs GitHub sayfasındaki</a> <strong>pkgs/top-evel/all-packages.nix</strong> sayfasıdır. Bu sayfada yaklaşık 40 bin paket callPackages fonksiyomnu ile yüklenmiştir. Detaylı bakacak olursanız bütün repo içinde 3-5 adet flake dosyası görebilirsiniz.</p>
<p>Ancak bu hali bize çok daha genişletilebilir (extendible), maintable ve daha modüler bir yapı sağlıyor.</p>
<ul>
<li>Sağladığı en önemli fayda artık derivation'ınımıza parametre geçebiliyoruz. Bu sayede aynı kod bloğunu farklı versiyonlar için de kullanabileceğiz. Tabi bu sadece bir örnek, neler yapabileceğimizi anlayabilmek için bir örnek. Eğer bir uygulamanın farklı versiyonlarını sunacaksanız (ki bu çok çok nadiren olacak bir durumdur) o zaman her birini ayrı ayrı sunmak daha mantıklı olacaktır. Örneğin <a href="https://github.com/NixOS/nixpkgs/tree/master/pkgs/development/compilers">Resmi paket yöneticisinde</a> kontrol ederseniz bir programlama dilinin veya bir SDK'in farklı versiyonlarının farklı dosyalarla yayınlandığını görebilirsiniz.</li>
<li>İkinci önemli faydası ise bu haliyle paketi override etmek için daha esnek yapı sunması. Bunu henüz görmedik ancak sadece bilgi vermek için yazıyorum. İleride göreceğiz.</li>
</ul>
<p>Basit bir örnekle başlayalım. Daha sonra bütün repo'muzu bu fonksiyonla nasıl yönetebileceğimizi göreceğiz.</p>
<p><strong>message-app</strong> adında bir klasör oluşturup içine <strong>default.nix</strong> dosyası oluşturuyoruz. Alttaki kodu içine kopyalıyoruz. Kod dikkat ederseniz artık bir flake değil. Sadece bir derivation döndüren fonksiyon. Ben de <strong>callPackage-first</strong> adından bir klasör içinde bu işlemleri yapıyorum. Github hesabımda kodları görebilirsiniz.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>version <span class="o">?</span> <span class="s2">&quot;v1.0&quot;</span><span class="p">}:</span>
    <span class="k">let</span>

      <span class="c1"># bu bile paketimizin özellikle kullandığı bir versiyon varsa ona göre yüklenebilir.</span>
      <span class="ss">nixpkgs</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{};</span>

      <span class="ss">selectedVersion</span> <span class="o">=</span> <span class="p">{</span><span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">;};</span>

      <span class="ss">simpleMessageAppSrc</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/muratcabuk/simple-message-app-with-c/archive/refs/tags/</span><span class="si">${</span>selectedVersion<span class="o">.</span>version<span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="p">;</span>

      <span class="ss">shaSet</span> <span class="o">=</span> <span class="p">{</span><span class="ss">v10</span><span class="o">=</span><span class="s2">&quot;sha256:1aai9xdkgq2vd0ch10gxhg53qfv4ny2x3jgxlq4r9nrn4g9r8s1z&quot;</span><span class="p">;</span>
                <span class="ss">v20</span><span class="o">=</span><span class="s2">&quot;sha256:11p3c793yjpm4z4j9shlidbii7wd0kf9qflx8jqhhnwwhqf93mam&quot;</span><span class="p">;</span>
                <span class="ss">v30</span><span class="o">=</span><span class="s2">&quot;sha256:1a4a2i32da9shc2d3i1ndarmla97bald7lgs1vjmwyjlry0mk4m7&quot;</span><span class="p">;};</span>

      <span class="ss">shaVer</span> <span class="o">=</span> <span class="nb">builtins</span><span class="o">.</span>concatStringsSep <span class="s2">&quot;&quot;</span> <span class="p">(</span>nixpkgs<span class="o">.</span>lib<span class="o">.</span>strings<span class="o">.</span>splitString <span class="s2">&quot;.&quot;</span> <span class="s2">&quot;</span><span class="si">${</span>selectedVersion<span class="o">.</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>

      <span class="ss">versionSha</span> <span class="o">=</span> <span class="nb">builtins</span><span class="o">.</span>getAttr shaVer shaSet<span class="p">;</span>

      <span class="c1"># Simple Message App&#39;in kaynak dizini</span>
      <span class="ss">src</span> <span class="o">=</span> <span class="nb">builtins</span><span class="o">.</span>fetchTarball <span class="p">{</span>
        <span class="ss">url</span> <span class="o">=</span> simpleMessageAppSrc<span class="p">;</span>
        <span class="ss">sha256</span> <span class="o">=</span> versionSha<span class="p">;</span>
      <span class="p">};</span>

    <span class="k">in</span>

        nixpkgs<span class="o">.</span>stdenv<span class="o">.</span>mkDerivation <span class="p">(</span>finalAttrs<span class="p">:</span> <span class="p">{</span>
              <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;message-app&quot;</span><span class="p">;</span>
              <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">${</span>selectedVersion<span class="o">.</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>

              <span class="ss">src</span> <span class="o">=</span> src<span class="p">;</span>

              <span class="ss">buildInputs</span> <span class="o">=</span> <span class="p">[</span> nixpkgs<span class="o">.</span>gcc <span class="p">];</span>
              <span class="ss">buildPhase</span> <span class="o">=</span> <span class="s2">&quot;gcc -o message-app </span><span class="si">${</span>src<span class="si">}</span><span class="s2">/message.c&quot;</span><span class="p">;</span>
              <span class="ss">installPhase</span> <span class="o">=</span> <span class="s2">&quot;mkdir -p $out/bin; install -t $out/bin message-app&quot;</span><span class="p">;</span>

              <span class="ss">meta</span> <span class="o">=</span> <span class="k">with</span> nixpkgs<span class="o">.</span>lib<span class="p">;</span> <span class="p">{</span>
                    <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Simple Message App with C&quot;</span><span class="p">;</span>
                    <span class="ss">license</span> <span class="o">=</span> licenses<span class="o">.</span>mit<span class="p">;</span>
                    <span class="ss">version</span> <span class="o">=</span>  <span class="s2">&quot;</span><span class="si">${</span>selectedVersion<span class="o">.</span>version<span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
                <span class="p">};</span>
        <span class="p">})</span>
</code></pre></div>
<p>Eğer callPackage fonksiyonunu kullanmasaydık alttaki gibi bir flake dosyası yazacaktık.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Flake için örnek paketler&quot;</span><span class="p">;</span>
  <span class="ss">inputs</span> <span class="o">=</span> <span class="p">{</span>
    nixpkgs<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="ss">outputs</span> <span class="o">=</span><span class="p">{</span> self<span class="p">,</span> nixpkgs<span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
    <span class="k">let</span>

        <span class="ss">packages</span> <span class="o">=</span> <span class="k">rec</span> <span class="p">{</span>

            x86_64-linux<span class="o">.</span><span class="ss">default</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">./message-app</span> <span class="p">{</span><span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;v3.0&quot;</span><span class="p">;};</span>
            x86_64-linux<span class="o">.</span><span class="ss">message-app</span> <span class="o">=</span> x86_64-linux<span class="o">.</span>default<span class="p">;</span>

            aarch64-linux<span class="o">.</span><span class="ss">message-app</span> <span class="o">=</span>  <span class="nb">import</span> <span class="l">./message-app</span> <span class="p">{</span><span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;v3.0&quot;</span><span class="p">;};</span>
        <span class="p">};</span>

    <span class="k">in</span>
    <span class="p">{</span>
    <span class="ss">packages</span> <span class="o">=</span> packages<span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>CallPackage fonksiyonu ile yazmak için Message-app klasörü ile aynı dizinde flake.nix dosyası oluşturup içine alttaki kodları kopyalıyoruz. Dikkat ederseniz artık istediğimiz versiyonu flake üzerinden geçebiliyoruz. Tabi bu yetenek ileride override ve overlay işlemlerimizde de işimize yarayacak.</p>
<p>Koddaki diğer bir farklılıkta artık sadece x86_64-linux değil aynı zamanda aarch64-linux için de paket sunuyoruz.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Flake için örnek paketler&quot;</span><span class="p">;</span>
  <span class="ss">inputs</span> <span class="o">=</span> <span class="p">{</span>
    nixpkgs<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="ss">outputs</span> <span class="o">=</span><span class="p">{</span> self<span class="p">,</span> nixpkgs<span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>
    <span class="k">let</span>
        <span class="ss">pkgs</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">&lt;nixpkgs&gt;</span> <span class="p">{</span> <span class="p">};</span>
        <span class="ss">packages</span> <span class="o">=</span> <span class="k">rec</span> <span class="p">{</span>

            x86_64-linux<span class="o">.</span><span class="ss">default</span> <span class="o">=</span> pkgs<span class="o">.</span>callPackage <span class="l">./message-app</span> <span class="p">{</span><span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;v3.0&quot;</span><span class="p">;};</span>
            x86_64-linux<span class="o">.</span><span class="ss">message-app</span> <span class="o">=</span> x86_64-linux<span class="o">.</span>default<span class="p">;</span>

            aarch64-linux<span class="o">.</span><span class="ss">message-app</span> <span class="o">=</span>  pkgs<span class="o">.</span>callPackage <span class="l">./message-app</span> <span class="p">{</span><span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;v3.0&quot;</span><span class="p">;};</span>
        <span class="p">};</span>

    <span class="k">in</span>
    <span class="p">{</span>
    <span class="ss">packages</span> <span class="o">=</span> packages<span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>Öncelikle paket detaylarını görelim.</p>
<div class="highlight"><pre><span></span><code>nix<span class="w"> </span>flake<span class="w"> </span>show<span class="w"> </span>--impure<span class="w"> </span>--all-systems
path:/home/..../callPackage-first?lastModified<span class="o">=</span><span class="m">1707332288</span><span class="p">&amp;</span><span class="nv">narHash</span><span class="o">=</span>sha256-FaBT3XCD%2BhhbvH2JkYuSbo1GjNrohFaTWE1YY%2B5pqDo%3D
└───packages
├───aarch64-linux
│<span class="w">   </span>└───message-app:<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;message-app&#39;</span>
└───x86_64-linux
├───default:<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;message-app&#39;</span>
└───message-app:<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;message-app&#39;</span>
</code></pre></div>
<p>Şimdi versiyon numarasını flake.nix içinden v3.0 olarak değiştirip çalıştıralım. V3'de kodda hatırlarsanız 3 adet soru soruyordu.</p>
<div class="highlight"><pre><span></span><code>nix<span class="w"> </span>run<span class="w"> </span>.#<span class="w"> </span>--impure
</code></pre></div>
<p>Devam etmeden önce çok kullanışlı bir paketi daha inceleyelim.</p>
<h2 id="flake-yonetimi-icin-frameworkler">Flake Yönetimi için Framework'ler</h2>
<p>En çok bilinenler</p>
<ul>
<li>Flake-Utils</li>
<li>Flake-Utils-Plus</li>
<li>Flake-Part</li>
<li>Flakelight</li>
</ul>
<p><a href="https://github.com/numtide/flake-utils">Flake-Utils'i</a> kullanmak zorundan değiliz ancak eğer geliştirdiğiniz paket hakikaten bir çok sistemde tamamen aynı konfigürasyon ve kurguyla çalışıyorsa kod tekrarından kurtulmak ve daha okunabilir bir kod için faydalı olacaktır.</p>
<p>callPackage-second klasörüne önceki dosyaları kopyalayalım ve flake.nix'i alttaki gibi değiştirelim.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Flake utils demo&quot;</span><span class="p">;</span>

  inputs<span class="o">.</span>flake-utils<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:numtide/flake-utils&quot;</span><span class="p">;</span>

  <span class="ss">outputs</span> <span class="o">=</span> <span class="p">{</span> self<span class="p">,</span> nixpkgs<span class="p">,</span> flake-utils <span class="p">}:</span>
    flake-utils<span class="o">.</span>lib<span class="o">.</span>eachDefaultSystem <span class="p">(</span>system<span class="p">:</span>
      <span class="k">let</span> <span class="ss">pkgs</span> <span class="o">=</span> nixpkgs<span class="o">.</span>legacyPackages<span class="o">.</span><span class="si">${</span>system<span class="si">}</span><span class="p">;</span> <span class="k">in</span>
      <span class="p">{</span>
        <span class="ss">packages</span> <span class="o">=</span> <span class="k">rec</span> <span class="p">{</span>
          <span class="ss">default</span> <span class="o">=</span>pkgs<span class="o">.</span>callPackage <span class="l">./message-app</span> <span class="p">{</span> <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;v3.0&quot;</span><span class="p">;</span> <span class="p">};</span>
          <span class="ss">message-app</span> <span class="o">=</span> default<span class="p">;</span>
        <span class="p">};</span>

      <span class="p">}</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Detaylarını bi görelim.</p>
<div class="highlight"><pre><span></span><code>nix flake show --impure --all-systems
path:/home/.../callPackage-first?lastModified=1707332163&amp;narHash=sha256-szc%2Bl9PZNAgwaH%2B7oSITJUTLIECgMn/GhuT/XT5d6HY%3D
└───packages
├───aarch64-darwin
│   ├───default: package &#39;message-app&#39;
│   └───message-app: package &#39;message-app&#39;
├───aarch64-linux
│   ├───default: package &#39;message-app&#39;
│   └───message-app: package &#39;message-app&#39;
├───x86_64-darwin
│   ├───default: package &#39;message-app&#39;
│   └───message-app: package &#39;message-app&#39;
└───x86_64-linux
├───default: package &#39;message-app&#39;
└───message-app: package &#39;message-app&#39;
</code></pre></div>
<p>Tabi bu arada sadece bu kadarla kalmıyor başka yetenekleri de var. Özellikle bu projeden fokr'lanarak geliştirilen flake-utils plus'ı da incelemenizi tavsiye ederim. Birden fazla channel (registry) ile çalışabilme, host aylarını dinamik değiştirme, input'lar üzerinden dinamik flake oluşturma vb bir çok yetenek kazandırıyor. <a href="https://github.com/gytis-ivaskevicius/flake-utils-plus">Resmi Github sayfasından</a> örnekleri incelebilirsiniz.</p>
<p>Plus'ın sayfasındaki örnekleri olduğu gibi taşıyorum. Fikir vermesi için çok güzel örnekler vermişler.</p>
<div class="highlight"><pre><span></span><code><span class="k">let</span>
  <span class="k">inherit</span> <span class="p">(</span><span class="nb">builtins</span><span class="p">)</span> <span class="nb">removeAttrs</span><span class="p">;</span>
  <span class="ss">mkApp</span> <span class="o">=</span> utils<span class="o">.</span>lib<span class="o">.</span>mkApp<span class="p">;</span>
  <span class="c1"># Eğer nixpkgs&#39;ye doğrudan bir referans almak gerekiyorsa,</span>
  <span class="ss">pkgs</span> <span class="o">=</span> self<span class="o">.</span>pkgs<span class="o">.</span>x86_64-linux<span class="o">.</span>nixpkgs<span class="p">;</span>
<span class="k">in</span> flake-utils-plus<span class="o">.</span>lib<span class="o">.</span>mkFlake <span class="p">{</span>


  <span class="c1"># `self` ve `inputs` argümanları GEREKLİDİR!</span>
  <span class="k">inherit</span> self inputs<span class="p">;</span>

  <span class="c1"># Paketler, uygulamalar, devShell ve diğer tanımlamalar için kullanılan desteklenen sistemler. Varsayılan olarak `flake-utils.lib.defaultSystems`.</span>
  <span class="ss">supportedSystems</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;x86_64-linux&quot;</span> <span class="p">];</span>


  <span class="c1">################</span>
  <span class="c1">### channels / registry ###</span>
  <span class="c1">################</span>

  <span class="c1"># Tüm kanallar arasında paylaşılan yapılandırma.</span>
  <span class="ss">channelsConfig</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">allowBroken</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span> <span class="p">};</span>

  <span class="c1"># Tüm kanallara uygulanan katmanlar.</span>
  <span class="ss">sharedOverlays</span> <span class="o">=</span> <span class="p">[</span> nur<span class="o">.</span>overlay <span class="p">];</span>

  <span class="c1"># Kanallar için nixpkgs flake referansı.</span>
  <span class="c1"># Varsayılan olarak `inputs` tarafından otomatik olarak oluşturulur.</span>
  channels<span class="o">.</span><span class="l">&lt;isim&gt;</span><span class="o">.</span><span class="ss">input</span> <span class="o">=</span> nixpkgs<span class="p">;</span>

  <span class="c1"># Kanala özgü yapılandırma seçenekleri.</span>
  channels<span class="o">.</span><span class="l">&lt;isim&gt;</span><span class="o">.</span><span class="ss">config</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">allowUnfree</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span> <span class="p">};</span>

  <span class="c1"># Seçilen kanala uygulanacak yamalar.</span>
  channels<span class="o">.</span><span class="l">&lt;isim&gt;</span><span class="o">.</span><span class="ss">patches</span> <span class="o">=</span> <span class="p">[</span> <span class="l">./someAwesomePatch.patch</span> <span class="p">];</span>

  <span class="c1"># Seçilen kanala uygulanacak katmanlar.</span>
  channels<span class="o">.</span><span class="l">&lt;isim&gt;</span><span class="o">.</span><span class="ss">overlaysBuilder</span> <span class="o">=</span> channels<span class="p">:</span> <span class="p">[</span>
    <span class="p">(</span>final<span class="p">:</span> prev<span class="p">:</span> <span class="p">{</span> <span class="k">inherit</span> <span class="p">(</span>channels<span class="o">.</span>unstable<span class="p">)</span> neovim<span class="p">;</span> <span class="p">})</span>
  <span class="p">];</span>


  <span class="c1">####################</span>
  <span class="c1">### hostDefaults ###</span>
  <span class="c1">####################</span>

  <span class="c1"># Tüm hostlar için kullanılacak varsayılan mimari, varsayılan olarak &quot;x86_64-linux&quot;.</span>
  hostDefaults<span class="o">.</span><span class="ss">system</span> <span class="o">=</span> <span class="s2">&quot;x86_64-linux&quot;</span><span class="p">;</span>

  <span class="c1"># Tüm hostlara aktarılacak varsayılan modüller.</span>
  hostDefaults<span class="o">.</span><span class="ss">modules</span> <span class="o">=</span> <span class="p">[</span> <span class="l">./module.nix</span> <span class="l">./module2</span> <span class="p">];</span>

  <span class="c1"># Host&#39;lar tarafından kullanılacak varsayılan kanalın referansı olarak `channels.&lt;isim&gt;.*`. Varsayılan olarak &quot;nixpkgs&quot;.</span>
  hostDefaults<span class="o">.</span><span class="ss">channelName</span> <span class="o">=</span> <span class="s2">&quot;unstable&quot;</span><span class="p">;</span>

  <span class="c1"># Tüm modüllere aktarılacak ek argümanlar. Hostların  extraArgs ile  birleştirilir.</span>
  hostDefaults<span class="o">.</span><span class="ss">extraArgs</span> <span class="o">=</span> <span class="p">{</span> <span class="k">inherit</span> utils inputs<span class="p">;</span> <span class="ss">foo</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span> <span class="p">};</span>


  <span class="c1">#############</span>
  <span class="c1">### Hosts ###</span>
  <span class="c1">#############</span>

  <span class="c1"># Sistem mimarisi. Varsayılan olarak `defaultSystem` argümanı.</span>
  hosts<span class="o">.</span><span class="l">&lt;hostname&gt;</span><span class="o">.</span><span class="ss">system</span> <span class="o">=</span> <span class="s2">&quot;aarch64-linux&quot;</span><span class="p">;</span>

  <span class="c1"># Kullanılacak kanalın &lt;isim&gt;. Varsayılan olarak `nixpkgs`;</span>
  hosts<span class="o">.</span><span class="l">&lt;hostname&gt;</span><span class="o">.</span><span class="ss">channelName</span> <span class="o">=</span> <span class="s2">&quot;unstable&quot;</span><span class="p">;</span>

  <span class="c1"># Modüllere aktarılacak ek argümanlar.</span>
  hosts<span class="o">.</span><span class="l">&lt;hostname&gt;</span><span class="o">.</span><span class="ss">extraArgs</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">abc</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span> <span class="p">};</span>

  <span class="c1"># Modüller için bunlar modül sisteminin bir parçası olmadığından,</span>
  <span class="c1"># modüllere &#39;imports&#39; satırlarında sonsuz döngü olmadan kullanılabilir.</span>
  hosts<span class="o">.</span><span class="l">&lt;hostname&gt;</span><span class="o">.</span><span class="ss">specialArgs</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">thing</span> <span class="o">=</span> <span class="s2">&quot;abc&quot;</span><span class="p">;</span> <span class="p">};</span>

  <span class="c1"># Host a özgü yapılandırma.</span>
  hosts<span class="o">.</span><span class="l">&lt;hostname&gt;</span><span class="o">.</span><span class="ss">modules</span> <span class="o">=</span> <span class="p">[</span> <span class="l">./configuration.nix</span> <span class="p">];</span>

  <span class="c1"># Yapılandırma için flake çıktısı. Varsayılan olarak `nixosConfigurations`.</span>
  hosts<span class="o">.</span><span class="l">&lt;hostname&gt;</span><span class="o">.</span><span class="ss">output</span> <span class="o">=</span> <span class="s2">&quot;darwinConfigurations&quot;</span><span class="p">;</span>

  <span class="c1"># Sistem oluşturucusu. Varsayılan olarak `channels.&lt;isim&gt;.input.lib.nixosSystem`.</span>
  hosts<span class="o">.</span><span class="l">&lt;hostname&gt;</span><span class="o">.</span><span class="ss">builder</span> <span class="o">=</span> nix-darwin<span class="o">.</span>lib<span class="o">.</span>darwinSystem<span class="p">;</span>


<span class="c1">#############################</span>
  <span class="c1">### flake outputs builder ###</span>
  <span class="c1">#############################</span>


  <span class="ss">outputsBuilder</span> <span class="o">=</span> channels<span class="p">:</span> <span class="p">{</span>
    <span class="c1"># `apps.&lt;sistem&gt;.custom-neovim = utils.lib.mkApp { drv = ...; exePath = ...; };` olarak değerlendirilir.</span>
    <span class="ss">apps</span> <span class="o">=</span> <span class="p">{</span>
      <span class="ss">custom-neovim</span> <span class="o">=</span> mkApp <span class="p">{</span>
        <span class="ss">drv</span> <span class="o">=</span> fancy-neovim<span class="p">;</span>
        <span class="ss">exePath</span> <span class="o">=</span> <span class="s2">&quot;/bin/nvim&quot;</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">};</span>

    <span class="c1"># `packages.&lt;sistem&gt;.package-from-overlays = &lt;unstable-nixpkgs-reference&gt;.package-from-overlays` olarak değerlendirilir.</span>
    <span class="ss">packages</span> <span class="o">=</span> <span class="p">{</span> <span class="k">inherit</span> <span class="p">(</span>channels<span class="o">.</span>unstable<span class="p">)</span> package-from-overlays<span class="p">;</span> <span class="p">};</span>

    <span class="c1"># `apps.&lt;sistem&gt;.firefox = utils.lib.mkApp { drv = ...; };` olarak değerlendirilir.</span>
    <span class="ss">defaultApp</span> <span class="o">=</span> mkApp <span class="p">{</span> <span class="ss">drv</span> <span class="o">=</span> channels<span class="o">.</span>nixpkgs<span class="o">.</span>firefox<span class="p">;</span> <span class="p">};</span>

    <span class="c1"># `defaultPackage.&lt;sistem&gt;.neovim = &lt;nixpkgs-channel-reference&gt;.neovim` olarak değerlendirilir.</span>
    <span class="ss">defaultPackage</span> <span class="o">=</span> channels<span class="o">.</span>nixpkgs<span class="o">.</span>neovim<span class="p">;</span>

    <span class="c1"># `devShell.&lt;sistem&gt; = &lt;nixpkgs-channel-reference&gt;.mkShell { name = &quot;devShell&quot;; };` olarak değerlendirilir.</span>
    <span class="ss">devShell</span> <span class="o">=</span> channels<span class="o">.</span>nixpkgs<span class="o">.</span>mkShell <span class="p">{</span> <span class="ss">name</span> <span class="o">=</span> <span class="s2">&quot;devShell&quot;</span><span class="p">;</span> <span class="p">};</span>
  <span class="p">};</span>


  <span class="c1">#########################################################</span>
  <span class="c1">### Diğer tüm özellikler flake&#39;e aktarılır ###</span>
  <span class="c1">#########################################################</span>

  checks<span class="o">.</span>x86_64-linux<span class="o">.</span><span class="ss">someCheck</span> <span class="o">=</span> pkgs<span class="o">.</span>hello<span class="p">;</span>
  packages<span class="o">.</span>x86_64-linux<span class="o">.</span><span class="ss">somePackage</span> <span class="o">=</span> pkgs<span class="o">.</span>hello<span class="p">;</span>
  <span class="ss">overlay</span> <span class="o">=</span> <span class="nb">import</span> <span class="l">./overlays</span><span class="p">;</span>
  <span class="ss">abc</span> <span class="o">=</span> <span class="mi">132</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>Bunların haricinde birde CircleCI'ın geliştirdiği flake-part var. Onu resmi <a href="https://github.com/hercules-ci/flake-parts">GitHub sayfasından</a> inceleyebilirsiniz. Temel amacı flake'leri daha modüler ve daha okunabilir bir yapıya kavuşturmak ve system bazında yönetimini saplamak.</li>
<li><a href="https://github.com/nix-community/flakelight">Flakelight</a> ise flake oluşturma süreçlerini otomatikleştirme, ortak yapılandırma ve flake'leri daha modüler hale getirme gibi özellikler sunuyor.</li>
</ul>
<p>Hemen hemen hepsinde mkFlake, mkApp fonksiyonları bulunuyor. Hepsinin de sistemleri yönetmek için yapılar mevcut.Temel amaçları flake 'laı daha parçalı hala getirmek böylece çok karmaşık flake'leri yönetmek daha kolay olmuş oluyor.</p>
<p><a href="https://discourse.nixos.org/t/flakelight-a-new-modular-flake-framework/32395/3">Şu sayfada</a> Flakelight ve Flake-Part'ı karşılaştıran güzel örnekler var.</p>
<p>Şimdi asıl konumuza dönelim. Bu vakte kadar öğrendiklerimizle kendi repo'muzu hem diğer sistemlerde de çalışacak hale getirelim hem de <strong>callPackage</strong> ile paketlerimizi yükleyelim.</p>
<h2 id="repommuzu-callpackege-fonksiyonu-ile-yeniden-yazyoruz">Repommuzu callPackege fonksiyonu ile Yeniden Yazıyoruz.</h2>
<p>Github'daki projemizi değiştiriyoruz. Yeni flake dosyamız alttaki gibi olacak. Tabi yazdığımız kodu da değiştirdik. Önceki versiyonda hatırlarsanız uygulama klasörlerimizde flake oluşturmuştuk. Ama artık module olarak değiştirdik. Artık daha okunaklılar. Ayrıca bu yeni versiyonda çalıştırılabilir (executable) modüller yazdığımız için her birini apps adında bir klasör oluşturup hepsini tek bir yere toplamış olduk. Bunun bir amacıda ileride ekleyeceğimiz diğer klasör ve dosyalarla karışmamalarını sağlamak.</p>
<p>Tüm kodlara <a href="https://github.com/muratcabuk/nix-examples/tree/multi-app-with-callpackages">multi-app-with-callpackages</a> branch'inden erişebilirsiniz.</p>
<p>Dikkat ederseniz <strong>eachSystem</strong> fonksiyonu iki parametre alıyor birincisi bir liste (systems) ikincisi ise fonksiyon.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
  <span class="ss">description</span> <span class="o">=</span> <span class="s2">&quot;Flake için örnek paketler&quot;</span><span class="p">;</span>
  <span class="ss">inputs</span> <span class="o">=</span> <span class="p">{</span>
    nixpkgs<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:nixos/nixpkgs/nixos-unstable&quot;</span><span class="p">;</span>
    flake-utils<span class="o">.</span><span class="ss">url</span> <span class="o">=</span> <span class="s2">&quot;github:numtide/flake-utils&quot;</span><span class="p">;</span>

  <span class="p">};</span>

  <span class="ss">outputs</span> <span class="o">=</span><span class="p">{</span> self<span class="p">,</span> nixpkgs<span class="p">,</span> flake-utils<span class="p">,</span> <span class="o">...</span> <span class="p">}:</span>

  <span class="k">let</span>

    <span class="ss">systems</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x86_64-linux&quot;</span> <span class="s2">&quot;x86_64-darwin&quot;</span><span class="p">];</span>

  <span class="k">in</span>

    flake-utils<span class="o">.</span>lib<span class="o">.</span>eachSystem systems <span class="p">(</span>system<span class="p">:</span>
      <span class="k">let</span> <span class="ss">pkgs</span> <span class="o">=</span> nixpkgs<span class="o">.</span>legacyPackages<span class="o">.</span><span class="si">${</span>system<span class="si">}</span><span class="p">;</span> <span class="k">in</span>
      <span class="p">{</span>
        <span class="ss">packages</span> <span class="o">=</span> <span class="k">rec</span> <span class="p">{</span>
            <span class="ss">default</span> <span class="o">=</span> pkgs<span class="o">.</span>callPackage <span class="l">./apps/default</span> <span class="p">{</span> <span class="ss">pkgs</span> <span class="o">=</span> pkgs<span class="p">;};</span>
            <span class="ss">defaultalt</span> <span class="o">=</span> pkgs<span class="o">.</span>callPackage <span class="l">./apps/defaultalt</span> <span class="p">{</span><span class="ss">pkgs</span> <span class="o">=</span> pkgs<span class="p">;};</span>
            <span class="ss">defaultfile</span> <span class="o">=</span> pkgs<span class="o">.</span>callPackage <span class="l">./apps/defaultfile</span> <span class="p">{</span><span class="ss">pkgs</span> <span class="o">=</span> pkgs<span class="p">;};</span>
            <span class="ss">message</span> <span class="o">=</span> pkgs<span class="o">.</span>callPackage <span class="l">./apps/message</span> <span class="p">{</span> <span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;v3.0&quot;</span><span class="p">;</span> <span class="ss">pkgs</span> <span class="o">=</span> pkgs<span class="p">;};</span>
            <span class="ss">nixapp</span> <span class="o">=</span> pkgs<span class="o">.</span>callPackage <span class="l">./apps/nixapp</span> <span class="p">{</span><span class="ss">pkgs</span> <span class="o">=</span> pkgs<span class="p">;};</span>
            <span class="ss">testapp</span> <span class="o">=</span> pkgs<span class="o">.</span>callPackage <span class="l">./apps/testapp</span> <span class="p">{</span><span class="ss">version</span> <span class="o">=</span> <span class="s2">&quot;v2.0&quot;</span><span class="p">;</span> <span class="ss">pkgs</span> <span class="o">=</span> pkgs<span class="p">;};</span>
        <span class="p">};</span>
      <span class="p">}</span>
    <span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
<p>Evet artık basit anlamda kendi repo'muzu oluşturduk ve birden fazla paketi aynı andan yayınladık. Şimdi de bence yeni öğrenenlerin en çok zorlandığı konulardan birine başlatalım. Override ve Overlay konuları kendi adıma beni en çok zorlayan konu oldu. Büyük ihtimal siz okurken kolay gibi gelecek ancak doküman yetersizliğinden dolayı anlama noktasına gelmek baya vaktimi almıştı. Zaten araştırırken de göreceksiniz en çok sorulan konulardan biri de bu.</p>
<p>Bu konuya da bir sonraki yazımızda devam edelim.</p>
<h1 id="kaynaklar">Kaynaklar</h1>
<ul>
<li><a href="https://zero-to-nix.com/concepts/flakes">https://zero-to-nix.com/concepts/flakes</a></li>
<li><a href="https://serokell.io/blog/practical-nix-flakes">https://serokell.io/blog/practical-nix-flakes</a></li>
<li><a href="https://nixos.wiki/index.php?title=Flakes">https://nixos.wiki/index.php?title=Flakes</a></li>
<li><a href="https://www.tweag.io/blog/2020-07-31-nixos-flakes/">https://www.tweag.io/blog/2020-07-31-nixos-flakes/</a></li>
<li><a href="https://nixos.wiki/wiki/Flakes#Introduction">https://nixos.wiki/wiki/Flakes#Introduction</a></li>
<li><a href="https://determinate.systems/posts/nix-run">https://determinate.systems/posts/nix-run</a></li>
<li><a href="https://nixos.wiki/wiki/Flakes">https://nixos.wiki/wiki/Flakes</a></li>
<li><a href="https://ertt.ca/nix/shell-scripts/">https://ertt.ca/nix/shell-scripts/</a></li>
<li><a href="https://fasterthanli.me/series/building-a-rust-service-with-nix/part-10">https://fasterthanli.me/series/building-a-rust-service-with-nix/part-10</a></li>
<li><a href="https://nix.dev/tutorials/file-sets.html">https://nix.dev/tutorials/file-sets.html</a></li>
<li><a href="https://nixos.wiki/wiki/Nix_Cookbook#Wrapping_packages">https://nixos.wiki/wiki/Nix_Cookbook#Wrapping_packages</a></li>
<li><a href="https://nixos.org/manual/nixpkgs/stable/#part-stdenv">https://nixos.org/manual/nixpkgs/stable/#part-stdenv</a></li>
<li><a href="https://ryantm.github.io/nixpkgs/builders/trivial-builders/">https://ryantm.github.io/nixpkgs/builders/trivial-builders/</a></li>
<li><a href="https://serokell.io/blog/practical-nix-flakes#basic-flake-structure">https://serokell.io/blog/practical-nix-flakes#basic-flake-structure</a></li>
<li><a href="https://lantian.pub/en/article/modify-computer/nixos-packaging.lantian/">https://lantian.pub/en/article/modify-computer/nixos-packaging.lantian/</a></li>
<li><a href="https://github.com/samdroid-apps/nix-articles">https://github.com/samdroid-apps/nix-articles</a></li>
<li><a href="https://github.com/djhshih/biopkgs/tree/master">https://github.com/djhshih/biopkgs/tree/master</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.sections", "navigation.prune", "content.action.edit", "content.action.view", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Kopyaland\u0131", "clipboard.copy": "Kopyala", "search.result.more.one": "Bu sayfada 1 tane daha", "search.result.more.other": "Bu sayfada # tane daha", "search.result.none": "E\u015fle\u015fen dok\u00fcman bulunamad\u0131", "search.result.one": "1 dok\u00fcman bulundu", "search.result.other": "# dok\u00fcman bulundu", "search.result.placeholder": "Aramaya ba\u015flamak i\u00e7in yaz\u0131n", "search.result.term.missing": "Eksik", "select.version": "Versiyon se\u00e7"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>